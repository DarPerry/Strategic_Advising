<!DOCTYPE html>
<html>

<head>
    <title>Strategic Advising</title>
    <link type="text/css" rel="stylesheet" href="stylesheets/add-modify-stylesheet.css">
    <link rel="shortcut icon" href="images/favicon.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <meta charset="utf-8" />

    <script>
        function GetCheckboxValue(checkbox) {
            if ($(checkbox).is(':checked')) {
                return "true";
            } else {
                return "false";
            }
        }

        $(document).ready(function() {
            document.getElementById("form").reset();
            //            window.alert(sessionStorage.getItem("studentInformation"));
            //            window.alert("New Student Mode: " + sessionStorage.getItem("newStudentMode"));



            $("#generateButton").click(function() {
                window.location.href = "output.html";
                return false
//                $.ajax({
//                    url: "../course_plans/computerScience.cpl",
//                    success: function(data) {
//                        //                        var coursesTaken = new Array();
//                        var coursesTaken = "MATH111;"
//                        var catalogArray = new Array();
//                        var semester = new Array();
//                        var studentSchedule = new Array();
//                        var coursePlan = JSON.parse(data);
//                        var maxCredits = 15;
//
//
//                        var semseterCreditLoad = 0;
//                        coursePlan.forEach(function(course) {
//                            catalogArray.push({
//                                "number": course.number,
//                                "credits": course.credits,
//                                "name": course.name,
//                                "prereqs": course.prereqs,
//                                "parallels": course.parallels
//                            })
//                        });
//
//                        for (var i = 0; i < catalogArray.length; i++) {
//                            semseterCreditLoad += parseInt(catalogArray[i].credits);
//                            if (semseterCreditLoad <= maxCredits && coursesTaken.includes(catalogArray[i].prereqs)) {
//                                // and if preqreqs are in course take
//                                coursesTaken.push(catalogArray[i].number)
//                                semester.push(catalogArray[i].number);
//                                // and remove this course from array
//
//
//                            }
//                        }
//                        alert(semester)
//
//
//                    }
//                })
//                return false;
                //                var arr = new Array();
                //                var studentSchedule = new Array();
                //                var maxCredits = 15;
                //                var total = 0;
                //                var semesterCourses = new Array();
                //                var output = new Array();
                //
                //                //-----------------------------------------------***=-----------------------------
                //                $.ajax({
                //                    url: "../course_plans/computerScience.cpl",
                //                    success: function(data) {
                //                        var coursePlan = JSON.parse(data);
                //                        coursePlan.courses.forEach(function(course) {
                //                            studentSchedule.push({
                //                                title: course.course_title,
                //                                credits: course.credits
                //                            });
                //                            //                                    if (course.course_title == "CS120") {
                //                            //                                        //Delete it
                //                            //                                    }
                //                        });
                //
                //                        for (var i = 0; i < studentSchedule.length; i++) {
                //                            total += parseInt(studentSchedule[i].credits);
                //                            if (total <= maxCredits) {
                //                                semesterCourses.push(studentSchedule[i].title);
                //                            } else if (total > maxCredits) {
                //                                output.push(
                //                                    semesterCourses
                //                                );
                //                                // move on to next semester
                //                                semesterCourses = new Array();
                //                                total = 0;
                //                            }
                //
                //                        };
                //                        output.push(semesterCourses);
                //                        sessionStorage.setItem("fall1", output[0]);
                //                        sessionStorage.setItem("spring1", output[1]);
                //                        sessionStorage.setItem("fall2", output[2]);
                //                        sessionStorage.setItem("spring2", output[3]);
                //                        sessionStorage.setItem("fall3", output[4]);
                //                        sessionStorage.setItem("spring3", output[5]);
                //                        sessionStorage.setItem("fall4", output[6]);
                //                        sessionStorage.setItem("spring4", output[7]);
                //
                //                        window.location.href = "output.html";
                //
                //                    }
                //
                //                });
                //                return false;
            });






            if (sessionStorage.getItem("newStudentMode") == 'false') {
                var sessionStudentInformation = sessionStorage.getItem("studentInformation");
                var studentObject = JSON.parse(sessionStudentInformation);
                $("#student-name").val(studentObject.student_name);
                $("#student-email").val(studentObject.student_email);
                $("#id-number").val(studentObject.id_number);
                $("#expected-graduation").val(studentObject.expected_graduation);

                $("input[name='major'][value='" + studentObject.major + "']").prop('checked', true);
                if (studentObject.concentration !== "undefined") {
                    $("input[name='conc'][value='" + studentObject.concentration + "']").prop('checked', true);
                }

                //                window.alert(GetCheckboxValue("#early-graduation"));
                if (studentObject.summer_classes == "true") {
                    $("#summer-classes").prop('checked', true);
                }
                if (studentObject.early_graduation == "true") {
                    $("#early-graduation").prop('checked', true);
                }
                if (studentObject.honors_college == "true") {
                    $("#honors-student").prop('checked', true);
                }

                $("#min-credits").val(studentObject.min_credits);
                $("#max-credits").val(studentObject.max_credits);

                studentObject.courses_taken.forEach(function(course) {
                    var splitCourseInfo = course.split("_");
                    var courseInfoRow = "<tr class='row'><td id='cname'>" + splitCourseInfo[0].toUpperCase() + "</td><td id='cnum'>" + splitCourseInfo[1].toUpperCase() + "</td></tr>";
                    $('.row').last().after(courseInfoRow);

                });
            } else if (sessionStorage.getItem("newStudentMode") == 'true') {
                if (!sessionStorage.getItem("newStudentMode") == 'null') {
                    $("#student-email").val(sessionStorage.getItem("newStudentEmail") + "@bsu.edu")
                }


            }

            //Fix Method
            $("#submit-button").click(function() {

                if ($("#student-email").val() != "") {
                    var courses_taken = new Array();
                    var tr_count = $('.row');
                    var summer_classes_bool;
                    var honors_college_bool;
                    var early_graduation_bool;
                    var course = "";

                    tr_count.each(function() {
                        course = $(this).find("#cname").text() + "_" + $(this).find("#cnum").text();
                        courses_taken.push('"' + course + '"');
                    });

                    courses_taken.shift();
                    courses_taken.sort();

                    var student =
                        '{"student_name": "' + $("#student-name").val() +
                        '", "student_email": "' + $("#student-email").val() +
                        '", "id_number" : ' + $("#id-number").val() +
                        ', "expected_graduation": "' + $("#expected-graduation").val() +
                        '", "major": "' + $(".major:checked").val() +
                        '", "concentration": "' + $(".concentration:checked").val() +
                        '", "courses_taken": [' + courses_taken.toString() +
                        '],  "summer_classes": "' + GetCheckboxValue($('#summer-classes')) +
                        '", "early_graduation": "' + GetCheckboxValue($('#early-graduation')) +
                        '", "honors_college": "' + GetCheckboxValue($('#honors-student')) +
                        '", "min_credits": ' + $("#min-credits").val() +
                        ', "max_credits":  ' + $('#max-credits').val() + "}";

                    $.post('modifyStudent.php', {
                            student_info: student,
                            student_email: $("#student-email").val()
                        },
                        function(data) {
                            window.alert("Your new information has been saved.");
                        });
                    sessionStorage.setItem("newStudentMode", "true");
                    return false;
                } else {
                    window.alert("ERROR: Student must have and email to be saved.");
                    return false;
                }
            });

            $("#add-button").click(function() {
                //Don't add if already exists
                if ($("#course-name").val() != '' && $("#course-number").val() != '') {
                    $('.row').last().after("<tr class='row'><td id='cname'>" + $("#course-name").val().toUpperCase() + "</td><td id='cnum'>" + $("#course-number").val() + "</td></tr>");
                }
                return false;
            });

            $("#delete-button").click(function() {
                //                window.alert($(".row").length);
                $(".row").each(function() {
                    if ($("#course-name").val().toUpperCase() + " " + $("#course-number").val() == $(this).find("#cname").html() + " " + $(this).find("#cnum").html()) {
                        this.remove();
                    }
                });
                return false;
            });

            $(".tab").click(function() {
                window.location.href = "search-page.html";
            });


        });

    </script>

</head>

<body>

    <div id="header">
        <div class="tab">Search Student</div>
    </div>
    <div id="left">
        <form id="form">
            <div id="student-info-input">
                Student Name:
                <input type=text id="student-name">
                <br> Student Email:
                <input type=text id="student-email">
                <br> Ball State ID Number:
                <input type=text id="id-number">
                <br> Expeted Graduation:
                <input type=text id="expected-graduation">
            </div>

            <div id="major-checkboxes">
                Major
                <br>
                <input type="radio" name="major" class="major" value="Actuarial Mathematics"> Actuarial Mathematics
                <br>
                <input type="radio" name="major" class="major" value="Mathematical Science"> Mathematical Science
                <br>
                <input type="radio" name="conc" class="concentration" value="Math"> Math
                <br>
                <input type="radio" name="conc" class="concentration" value="Applied Science"> Applied Science
                <br>
                <input type="radio" name="major" class="major" value="Mathematics Teaching"> Mathematics Teaching
                <br>
                <input type="radio" name="conc" class="concentration" value="Middle School"> Middle School
                <br>
                <input type="radio" name="conc" class="concentration" value="Secondary School"> Secondary School
                <br>
                <input type="radio" name="major" class="major" value="Computer Science"> Computer Science
            </div>
            <button id="submit-button">Submit</button>

    </div>
    <div id="right">
        <h3>Courses Taken</h3>
        <table id="courses-taken">
            <thead>
                <tr id="head-row">
                    <td>Department</td>
                    <td>Course Number</td>
                    <td>Course Title</td>
                </tr>

            </thead>
            <tbody>
                <tr class="row" style="display:none">

                </tr>


            </tbody>
        </table>
        <br>
        <div id="criteria-input">
            <div id=checkboxes>
                <input type="checkbox" name="criteria" value="summer-school" id="summer-classes">Summer Classes
                <input type="checkbox" name="criteria" value="early-grad" id="early-graduation">Early Graduation
                <input type="checkbox" name="criteria" value="honors-student" id="honors-student">Honors Student
            </div>

            <div class="credit-range">
                Minimum Credits/Semester
                <br>
                <input type="number" class="tiny-number-input" id="min-credits" value=12>
                <br> Maximum Credits/Semester
                <br>
                <!--make range slide -->
                <input type="number" class="tiny-number-input" id="max-credits" value=18>
            </div>
        </div>

        <div id="add-delete-course">
            <div class="course-text-input">
                Course Name: <br>
                <input type="text" id="course-name" style="text-transform:uppercase">
            </div>
            <div class="course-text-input">
                Course Number:<br>
                <input type="text" id="course-number">
            </div>
            <div id="button-container">
                <button id="add-button">Add</button>
                <br>
                <button id="delete-button">Delete</button>

                <br>
            </div>
            <br>
            <br>
            <button id=generateButton>See/Generate Schedule</button>

        </div>
        </form>
    </div>
    <div id="footer"></div>
</body>

</html>
